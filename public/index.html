
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pete's Vanquis Bank Game</title>
    <!-- update the version number as needed -->
    <script defer src="/__/firebase/7.15.0/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/7.15.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.15.0/firebase-database.js"></script>
    <script defer src="/__/firebase/7.15.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/7.15.0/firebase-storage.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
<body onload="startGame()">
<script>
var myGamePiece;
var myObstacles = [];
var myTargets = [];
var myScore;
//target is selected
var targetSelected = true
var selectedTarget = -1

//background and stall front images
var mainBackgoundImg = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/mainCanvasBackground.png?alt=media&token=ecef3fac-ab06-4375-80f0-e3d4d3b9ff68"
var stallBottom = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/stallBottom.png?alt=media&token=f0e58bad-6520-44c3-a410-645fa4f34ac9"

//target images
var targetImg0 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target1.png?alt=media&token=396992c3-5dbb-4655-b53e-18f974669891" 
var targetImg1 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target2.png?alt=media&token=2dc6ee00-6c33-4175-aefa-780a45397206"
var targetImg2 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target3.png?alt=media&token=85448202-89f9-43ca-a13b-0a52cce7a207"
var targetImg3 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target4.png?alt=media&token=efd010c3-01bf-474a-b2d4-33af69be5692"
var targetImg4 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target5.png?alt=media&token=f2b96a09-4354-4df1-a9f8-1c2e479bdcf5"
var targetImg5 = "https://firebasestorage.googleapis.com/v0/b/vanquisgame.appspot.com/o/target6.png?alt=media&token=cb792400-876b-4b17-8840-df563c6cc472"

//small and large sign target position when coming up
var targetOddY = 180
var targetEventY = 255

function startGame() {
    myGamePiece = new component(30, 30, "red", 10, 120);
    myGamePiece.gravity = 0.05;

//Add the Targets
/*
    End states here:
    myTargets.push(new component(70, 75, targetImg1, 65, 255, "image"));
    myTargets.push(new component(70, 150, targetImg2, 105, 180, "image"));
    myTargets.push(new component(70, 75, targetImg3, 150, 255, "image"));
    myTargets.push(new component(70, 150, targetImg4, 195, 180, "image"));
    myTargets.push(new component(70, 75, targetImg5, 240, 255, "image"));
    myTargets.push(new component(70, 150, targetImg6, 285, 180, "image"));

*/
    myTargets.push(new component(70, 75, targetImg0, 65, 330, "image","target0"));
    myTargets.push(new component(70, 150, targetImg1, 105, 330, "image","target1"));
    myTargets.push(new component(70, 75, targetImg2, 150, 330, "image","target2"));
    myTargets.push(new component(70, 150, targetImg3, 195, 330, "image","target3"));
    myTargets.push(new component(70, 75, targetImg4, 240, 330, "image","target4"));
    myTargets.push(new component(70, 150, targetImg5, 285, 330, "image","target5"));


//Set Stall image
    gameStalls = new component(325, 140, stallBottom, 45, 330, "image");
    
    myScore = new component("20px", "Consolas", "white", 440, 416, "text");

    myGameArea.start();


}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
            img = new Image();
            img.src = mainBackgoundImg
            this.canvas.width = 588;
            this.canvas.height = 431;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.frameNo = 0;
            this.interval = setInterval(updateGameArea, 20);
            this.context.drawImage(img, 10, 10);

            //Add listeners
            var elemLeft = this.canvas.offsetLeft + this.canvas.clientLeft,
                elemTop = this.canvas.offsetTop + this.canvas.clientTop
            // Add event listener for `click` events.
            this.canvas.addEventListener('click', function(event) {
                var x = event.pageX - elemLeft,
                    y = event.pageY - elemTop;
                    alert('Click recorded ' + x + ' ' + y + 'target 0 Top '+ myTargets[0].y);
                myTargets.forEach(function(element) {
                    if (y > element.y && y < element.y + element.height 
                        && x > element.x && x < element.x + element.width) {
                        alert(element.name + " clicked");
                    }
                });

            }, false);
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        img = new Image();
        img.src = mainBackgoundImg
        this.context.drawImage(img, 10, 10);
    }
}

function component(width, height, color, x, y, type, name) {
    this.type = type;
    this.name = name;
    this.score = 0;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;
    this.gravity = 0;
    this.gravitySpeed = 0;
    this.update = function() {
        ctx = myGameArea.context;
        if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
        } 
       else if (type == "image") {
            this.image = new Image();
            this.image.src = color;
            ctx.drawImage(this.image,
            this.x,
            this.y,
            this.width, this.height);
        }
        else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }
    this.newPos = function() {
        this.gravitySpeed += this.gravity;
        this.x += this.speedX;
        this.y += this.speedY + this.gravitySpeed;
        this.hitBottom();
    }
    this.hitBottom = function() {
        var rockbottom = myGameArea.canvas.height - this.height;
        if (this.y > rockbottom) {
            this.y = rockbottom;
            this.gravitySpeed = 0;
        }
    }
    this.crashWith = function(otherobj) {
        var myleft = this.x;
        var myright = this.x + (this.width);
        var mytop = this.y;
        var mybottom = this.y + (this.height);
        var otherleft = otherobj.x;
        var otherright = otherobj.x + (otherobj.width);
        var othertop = otherobj.y;
        var otherbottom = otherobj.y + (otherobj.height);
        var crash = true;
        if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
            crash = false;
        }
        return crash;
    }
        var canvas = document.getElementById("canvas")
       
}

function updateGameArea() {
    var x, height, gap, minHeight, maxHeight, minGap, maxGap;
    for (i = 0; i < myObstacles.length; i += 1) {
        if (myGamePiece.crashWith(myObstacles[i])) {
            return;
        } 
    }
    myGameArea.clear();
    myGameArea.frameNo += 1;
    if (myGameArea.frameNo == 1 || everyinterval(150)) {
        x = myGameArea.canvas.width;
        minHeight = 20;
        maxHeight = 200;
        height = Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
        minGap = 50;
        maxGap = 200;
        gap = Math.floor(Math.random()*(maxGap-minGap+1)+minGap);
        myObstacles.push(new component(10, height, "green", x, 0));
        myObstacles.push(new component(10, x - height - gap, "green", x, height + gap));
    }
    /*
    for (i = 0; i < myObstacles.length; i += 1) {

        myObstacles[i].x += -1;

        myObstacles[i].update();
    }
    */
    myScore.text="Time: " + (myGameArea.frameNo/100);
    myScore.update();


    //Select a target
    //set boolean
    //while set move till max
    //if hit, set false select new target and repeat



    
    //TODO: Process the target movements.
    for (i = 0; i < myTargets.length; i += 1) {
     var min = Math.ceil(0);
     var max = Math.floor(myTargets.length);
     selectedTarget = Math.floor(Math.random() * (max - min + 1)) + min;
     console.log("random element = "+selectedTarget) 
      //target is not shot down
        if(selectedTarget % 2 > 0){
            if(myTargets[selectedTarget].y > targetOddY){
                myTargets[selectedTarget].y += -1;
            }
        }else{
            if(myTargets[selectedTarget].y > targetEventY){
                myTargets[selectedTarget].y += -1;   
            }
        }
        myTargets[selectedTarget].update();        
    }
    //myGamePiece.newPos();
    //myGamePiece.update();
    gameStalls.update();



}

function everyinterval(n) {
    if ((myGameArea.frameNo / n) % 1 == 0) {return true;}
    return false;
}

function accelerate(n) {
    myGamePiece.gravity = n;
}
</script>
<!--
    <div id="message">
      <h2>Welcome</h2>
      <h1>Firebase Hosting Setup Complete</h1>
      <p>You're seeing this because you've successfully setup Firebase Hosting. Now it's time to go build something extraordinary!</p>
      <a target="_blank" href="https://firebase.google.com/docs/hosting/">Open Hosting Documentation</a>
    </div>
    <p id="load">Firebase SDK Loading&hellip;</p>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        try {
          let app = firebase.app();
          let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
          console.error(e);
          document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
        }
      });
    </script>
  -->
  </body>
</html>